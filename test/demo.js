!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var r;n.r(e),function(t){t[t.BOOLEAN=2]="BOOLEAN",t[t.NUMBER=4]="NUMBER",t[t.STRING=8]="STRING",t[t.ARRAY=16]="ARRAY",t[t.DATE=32]="DATE",t[t.ANY=64]="ANY",t[t.PRIMARY=128]="PRIMARY"}(r||(r={}));var i=function(){function t(){}return t.prototype.gCreateTableSql=function(t,e){var n="CREATE TABLE IF NOT EXISTS "+t,i=[];if(e instanceof Array&&e.length>0)for(var o=0;o<e.length;o++){var u=e[o],s=void 0;s="TEXT",(u.type&r.STRING)===r.STRING&&(s="TEXT"),(u.type&r.NUMBER)===r.NUMBER&&(s="NUMERIC"),(u.type&r.BOOLEAN)===r.BOOLEAN&&(s="INTEGER"),(u.type&r.ARRAY)===r.ARRAY&&(s="TEXT"),(u.type&r.ANY)===r.ANY&&(s="TEXT"),(u.type&r.PRIMARY)===r.PRIMARY&&(s+=" PRIMARY KEY NOT NULL"),i.push(u.name+" "+s)}return n+" ("+i.join(", ")+")"},t.prototype.gInsertSql=function(t,e,n){var r="insert into "+t+" ",i=[],o=[];if(e instanceof Array&&e.length>0){for(var u=[],s=0;s<e.length;s++){var c=e[s];i.push(c.name),o.push("?"),u.push(n[c.name])}return[r+=" ("+i.join(",")+") values ("+o.join(",")+")",u]}return null},t.prototype.gUpdateSql=function(t,e,n,r){var i="update "+t+" set ",o=[],u=[];if(null!=r)for(var s in r)if(r.hasOwnProperty(s)){if(s==e)continue;var c=r[s];o.push(s),u.push(c)}return i+=o.join(" = ? , ")+" = ? where "+e+" = ? ;",u.push(n),[i,u]},t}(),o=function(){function t(){}return t.getDataBase=function(t,e){return null==this.db&&(this.db={}),null==this.db[t]&&(this.db[t]=window.openDatabase(t,"1.0.0","",e)),this.db[t]},t}(),u=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function u(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(u,s)}c((r=r.apply(t,e||[])).next())})},s=function(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},c=function(){function t(t){this.objClass=t,this.gSql=new i,this.tableName=this.objClass.__table_name__,this.dbName=this.objClass.__db_name__,this.columnsDef=this.objClass.__columns__,this.db=o.getDataBase(this.dbName,655360)}return t.prototype.init=function(){return u(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.createTable(this.columnsDef)];case 1:return t.sent(),[2]}})})},t.prototype.queryFirst=function(t){return u(this,void 0,void 0,function(){var e,n,r,i;return s(this,function(o){switch(o.label){case 0:return e=this,[4,this.init()];case 1:return o.sent(),[4,this.queryAll()];case 2:if(null!=(n=o.sent())&&n.length>0)for(r=0;r<n.length;r++)if(i=n[r],t(i))return[2,e.convertToMetadata(i)];return[2,null]}})})},t.prototype.queryAll=function(){return u(this,void 0,void 0,function(){var t,e;return s(this,function(n){switch(n.label){case 0:return t=this,[4,this.init()];case 1:return n.sent(),e="select * from "+this.tableName,[2,new Promise(function(n){t.db.transaction(function(r){r.executeSql(e,[],function(t,e){n(e.rows)},t.fail)})})]}})})},t.prototype.delete=function(t){return u(this,void 0,void 0,function(){var e,n,i,o,u,c;return s(this,function(s){switch(s.label){case 0:return e=this,[4,this.init()];case 1:return s.sent(),[4,this.queryFirst(t)];case 2:for(n=s.sent(),o=0;o<this.columnsDef.length;o++)((u=this.columnsDef[o]).type&r.PRIMARY)==r.PRIMARY&&(i=u.name);return c="delete from "+this.tableName+" where "+i+" = ? ;",[2,new Promise(function(t){e.db.transaction(function(r){r.executeSql(c,[n[i]],function(e,n){t(n.rowsAffected>0)},e.fail)})})]}})})},t.prototype.existRecord=function(t){return u(this,void 0,void 0,function(){var e,n,i;return s(this,function(o){switch(o.label){case 0:return e=this,[4,this.init()];case 1:return o.sent(),n=this.columnsDef.find(function(t){return(t.type&r.PRIMARY)==r.PRIMARY}),i="select * from "+this.tableName+" where "+n.name+" = ? ;",[2,new Promise(function(n){e.db.transaction(function(r){r.executeSql(i,[t],function(t,e){n(null!=e.rows&&e.rows.length>0)},e.fail)})})]}})})},t.prototype.createTable=function(t){return u(this,void 0,void 0,function(){var e;return s(this,function(n){return e=this,[2,new Promise(function(n){e.db.transaction(function(r){r.executeSql(e.gSql.gCreateTableSql(e.tableName,t),[],function(t,e){n(1==e.insertId)},function(t,r){return e.fail(t,r),n(!1),!0})})})]})})},t.prototype.insert=function(t){return u(this,void 0,void 0,function(){var e,n;return s(this,function(r){switch(r.label){case 0:return console.log(t),e=this.gSql.gInsertSql(this.tableName,this.objClass.__columns__,t),n=this,[4,this.init()];case 1:return r.sent(),[2,new Promise(function(t){n.db.transaction(function(r){r.executeSql(e[0],e[1],function(e,n){t(1==n.insertId)},function(e,r){return n.fail(e,r),t(!1),!0})})})]}})})},t.prototype.convertToMetadata=function(t){var e=new this.objClass;for(var n in e.__diff__={},t)if(t.hasOwnProperty(n)){var r=t[n];e[n]=r,e.__diff__[n]=r}return e},t.prototype.execSql=function(t,e){return u(this,void 0,void 0,function(){var n;return s(this,function(r){switch(r.label){case 0:return n=this,[4,this.init()];case 1:return r.sent(),[2,new Promise(function(r){n.db.transaction(function(i){i.executeSql(t,e,function(t,e){r(e.rowsAffected)},n.fail)})})]}})})},t.prototype.fail=function(t,e){return console.error(e.message),!0},t}(),a=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function u(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(u,s)}c((r=r.apply(t,e||[])).next())})},l=function(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},f=function(){function t(){this.gSql=new i,this.columnsDef=this.constructor.__columns__,this.primaryColDef=this.columnsDef.find(function(t){return(t.type&r.PRIMARY)==r.PRIMARY}),this.tableName=this.constructor.__table_name__}return t.prototype.save=function(){return a(this,void 0,void 0,function(){var t,e,n,r;return l(this,function(i){switch(i.label){case 0:return t=this.queryChange(),e=this.__diff__,[4,this.existRecord()];case 1:return n=i.sent(),r=n?this.gSql.gUpdateSql(this.tableName,this.primaryColDef.name,e[this.primaryColDef.name],t):this.gSql.gInsertSql(this.tableName,this.columnsDef,this),[4,new c(this.constructor).execSql(r[0],r[1])];case 2:return[2,i.sent()>0]}})})},t.prototype.queryChange=function(){var t={},e=this.__diff__;if(null!=e)for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];this[n]!=r&&(t[n]=this[n])}return t},t.prototype.existRecord=function(){return a(this,void 0,void 0,function(){var t;return l(this,function(e){switch(e.label){case 0:return t=this.__diff__,[4,new c(this.constructor).existRecord(t[this.primaryColDef.name])];case 1:return[2,e.sent()]}})})},t.query=function(t){return a(this,void 0,void 0,function(){var e,n,r,i,o;return l(this,function(u){switch(u.label){case 0:return[4,(e=new c(this)).queryAll()];case 1:if(null!=(n=u.sent())&&n.length>0){for(r=[],i=0;i<n.length;i++)o=n[i],t(o)&&r.push(e.convertToMetadata(o));return[2,r]}return[2,null]}})})},t.queryFirst=function(t){return a(this,void 0,void 0,function(){var e,n,r,i;return l(this,function(o){switch(o.label){case 0:return[4,(e=new c(this)).queryAll()];case 1:if(null!=(n=o.sent())&&n.length>0)for(r=0;r<n.length;r++)if(i=n[r],t(i))return[2,e.convertToMetadata(i)];return[2,null]}})})},t.delete=function(t){return a(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return[4,this.queryFirst(t)];case 1:return e.sent(),[4,new c(this).delete(t)];case 2:return[2,e.sent()]}})})},t.import=function(t){return new c(this).convertToMetadata(t)},t}();function h(t){return function(e,n){var r={name:n,type:t},i=e.constructor;i.__columns__||(i.__columns__=new Array),i.__columns__.push(r)}}var p=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=function(t,e,n,r){var i,o=arguments.length,u=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(u=(o<3?i(u):o>3?i(e,n,u):i(e,n))||u);return o>3&&u&&Object.defineProperty(e,n,u),u},y=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),d([h(r.STRING|r.PRIMARY),y("design:type",String)],e.prototype,"id",void 0),d([h(r.STRING),y("design:type",String)],e.prototype,"user_name",void 0),d([h(r.STRING),y("design:type",String)],e.prototype,"password",void 0),d([function(t){t.__db_name__="student_db",t.__table_name__=t.name}],e)}(f);n.d(e,"Demo",function(){return v});var v=function(){function t(){}return t.prototype.testCreate=function(){var t=new b;t.id="guid",t.user_name="小明",t.password="123456",t.save()},t.prototype.runTest=function(){this.testCreate()},t}();(new v).runTest()}]);